{"job":{"components":{"2709686":{"id":2709686,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2709834],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2709777":{"id":2709777,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1043089869,"x":96,"y":32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"API Extract 0"}}}},"visible":true},"2":{"slot":2,"name":"API","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RestCountriesAPI"}}}},"visible":false},"3":{"slot":3,"name":"API Environment","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Production"}}}},"visible":false},"4":{"slot":4,"name":"API Version","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"default"}}}},"visible":false},"5":{"slot":5,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CountriesByRegion"}}}},"visible":true},"6":{"slot":6,"name":"Auth Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"7":{"slot":7,"name":"Api Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"8":{"slot":8,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"9":{"slot":9,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"10":{"slot":10,"name":"OAuth","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"11":{"slot":11,"name":"Page Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"1"}}}},"visible":true},"12":{"slot":12,"name":"URI Params","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"region"},"2":{"slot":2,"type":"STRING","value":"${region_jobvar}"}}}},"visible":true},"13":{"slot":13,"name":"Query Params","elements":{},"visible":true},"14":{"slot":14,"name":"Header Params","elements":{},"visible":true},"15":{"slot":15,"name":"Post Body","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"16":{"slot":16,"name":"Api Key Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"17":{"slot":17,"name":"Api Key Value","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"18":{"slot":18,"name":"Bearer Token","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"22":{"slot":22,"name":"Profile","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RestCountriesAPI"}}}},"visible":true},"113":{"slot":113,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"azure://snapinternal/ahmet/"}}}},"visible":true},"114":{"slot":114,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"115":{"slot":115,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"116":{"slot":116,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"117":{"slot":117,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"country_${region_jobvar}"}}}},"visible":true},"118":{"slot":118,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[2709837]},"2709835":{"id":2709835,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":96,"y":0,"width":32,"height":16,"inputConnectorIDs":[2709834],"outputSuccessConnectorIDs":[2709852],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"regions"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"region_name"},"2":{"slot":2,"type":"STRING","value":"region_jobvar"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"7":{"slot":7,"name":"Stop on Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"8":{"slot":8,"name":"Stop Condition Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":false},"9":{"slot":9,"name":"Condition","elements":{},"visible":false},"10":{"slot":10,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"11":{"slot":11,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[2709837],"inputIterationConnectorIDs":[]},"2709853":{"id":2709853,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":194,"y":3,"width":32,"height":32,"inputConnectorIDs":[2709852],"outputSuccessConnectorIDs":[2710162],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RulesEngine_flatten 0"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RulesEngine_flatten"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2710163":{"id":2710163,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1155583855,"x":320,"y":0,"width":32,"height":32,"inputConnectorIDs":[2710162],"outputSuccessConnectorIDs":[2710240],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Query Result To Grid 0"}}}},"visible":true},"2":{"slot":2,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Basic"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"4":{"slot":4,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"structured_countries"}}}},"visible":true},"6":{"slot":6,"name":"Table Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"capital-element"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"cca2"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"name_official"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"population"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"region"}}}},"visible":true},"7":{"slot":7,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/* Note: this query will be run as a subquery for the purposes of sampling the data.\n   As such it will be restricted by any subquery limitations specified by the current platform. */"}}}},"visible":false},"8":{"slot":8,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"regions"}}}},"visible":true},"9":{"slot":9,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"region"}}}},"visible":true},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":true},"11":{"slot":11,"name":"Order By","elements":{},"visible":true},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":true},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":true},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true},"20":{"slot":20,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2710241":{"id":2710241,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":320,"y":80,"width":32,"height":32,"inputConnectorIDs":[2710240],"outputSuccessConnectorIDs":[2710293],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import requests \nimport json \n\ncountry_list = context.getGridVariable('countries') \ncountry_list_updated = [] \n\nfor each in country_list: \n\ttry: \n\t\tcountry_code = each[0].strip(\"'\")\n\t\tprint(country_code) #Which country? \n\t\tr = requests.get('https://www.travel-advisory.info/api?countrycode='+str(country_code)) \n\t\tprint(r.text) #raw response body \n\t\trisk_score = r.json()['data'][country_code]['advisory']['score'] \n\t\trisk_message = r.json()['data'][country_code]['advisory']['message'] \n\t\tcountry_entry = [str(each[0]), \n\t\t\tstr(each[1]), \n\t\t\tstr(each[2]), \n\t\t\tstr(each[3]), \n\t\t\tstr(each[4]), \n\t\t\tstr(risk_score), \n\t\t\tstr(risk_message) \n\t\t\t] \n\t\tcountry_list_updated.append(country_entry) \n\texcept:\n\t\tpass \n\t\t\ncontext.updateGridVariable('countries', country_list_updated) \nprint(context.getGridVariable('countries'))"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2710290":{"id":2710290,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":418,"y":75,"width":32,"height":32,"inputConnectorIDs":[2710293],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RulesEngine_final 0"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RulesEngine_final"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"countries"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"countryCode"},"2":{"slot":2,"type":"GRID","value":"countryName"},"3":{"slot":3,"type":"GRID","value":"countryCapital"},"4":{"slot":4,"type":"GRID","value":"countryPopulation"},"5":{"slot":5,"type":"GRID","value":"countryRegion"},"6":{"slot":6,"type":"GRID","value":"riskLevel"},"7":{"slot":7,"type":"GRID","value":"riskMessage"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"countries_xform"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2709852":{"id":2709852,"sourceID":2709835,"targetID":2709853},"2710162":{"id":2710162,"sourceID":2709853,"targetID":2710163},"2710240":{"id":2710240,"sourceID":2710163,"targetID":2710241},"2710293":{"id":2710293,"sourceID":2710241,"targetID":2710290}},"failureConnectors":{},"unconditionalConnectors":{"2709834":{"id":2709834,"sourceID":2709686,"targetID":2709835}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"2709837":{"id":2709837,"sourceID":2709835,"targetID":2709777}},"noteConnectors":{},"notes":{},"variables":{"region_jobvar":{"definition":{"name":"region_jobvar","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"default"}},"grids":{"countries":{"definition":{"name":"countries","scope":"TASKBATCH","definitions":[{"name":"countryCode","type":"TEXT"},{"name":"countryName","type":"TEXT"},{"name":"countryCapital","type":"TEXT"},{"name":"countryPopulation","type":"TEXT"},{"name":"countryRegion","type":"TEXT"},{"name":"riskLevel","type":"TEXT"},{"name":"riskMessage","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["AT","Austria","Vienna","8725931","Europe","risklevel1","riskmessage1"]}]},"regions":{"definition":{"name":"regions","scope":"BRANCH","definitions":[{"name":"region_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[{"values":["asia"]},{"values":["europe"]},{"values":["africa"]}]}}},"info":{"name":"RulesEngine","description":null,"type":"ORCHESTRATION","tag":"313834b8-ea78-4713-a551-00307394bcfd"}}